# ──────────────────────────────────────────
#  .cursorrules – Weak Inhomogeneity Project
#  最終更新: 2025‑07‑15
#  Author: Tomoyuki Kano
# ──────────────────────────────────────────

############################################
# Level 1 – 共通ポリシー（全ファイル対象）
############################################
[level_1]
always = [
  # コメントとドキュメント
  "日本語をベースに、初出の専門用語は括弧で英語を併記する",
  "公開 API や CLI は Google‑style Docstring を必須とする",
  # コミット
  "コミットメッセージは Conventional Commits を遵守する",
  # レビュー
  "AI 生成コードは必ず人間レビューを経てマージする"
]

############################################
# Level 2 – 言語別スタイル
############################################
# Python（src/, scripts/ 以下）
[level_2.python]
files = ["src/**/*.py", "scripts/**/*.py"]
always = [
  "snake_case を使用する（定数は UPPER_SNAKE_CASE）",
  "型ヒント (PEP 484) を必須化し mypy --strict が通ること",
  "JAX NumPy を優先し、不要な NumPy → JAX 変換を避ける"
]
tools = [
  "ruff --fix",              # Lint & auto‑fix
  "black --line-length 100", # フォーマッタ
  "mypy --strict"            # 型チェック
]

# Nix（パッケージ/CI 定義）
[level_2.nix]
files = ["*.nix", "nix/**/*.nix"]
always = ["2 スペースインデント、末尾空白禁止"]
tools  = ["alejandra -q"]     # Nix フォーマッタ

# Markdown / Docs
[level_2.docs]
files = ["README*.md", "docs/**/*.md"]
always = [
  "見出しは日本語、() 内に英語訳を併記",
  "表やコードブロックに冗長な空行を入れない"
]

############################################
# Level 3 – 品質保証ツールチェーン
############################################
[level_3]
tools = [
  # 再現性確認
  "nix flake check",
  # ユニット & 統合テスト
  "pytest -q tests/",
  # フォーマット一括
  "pre-commit run --all-files"
]

############################################
# Level 4 – 実験固有ルール
############################################
[level_4]
always = [
  "Stage 1 実験パラメータは config/experiment_config.yaml に一元管理する",
  "実験スクリプトは --dry-run オプションを必ず実装する",
  "GPU 利用率ログを data/logs/ に 60 s 間隔で保存する"
]

############################################
# Level 5 – セキュリティ / プライバシ
############################################
[level_5]
always = [
  "プライバシーモードが OFF の場合でも個人データはサニタイズして送信する",
  "API キーを .env 以外のファイルにハードコードしない",
  "社内限定情報を含む質問には回答を拒否するかマスキングする"
]
